import{h as d}from"./hiddenContentLoader-BvZHvYTg.js";import{r as l,h as p,f as h}from"./api-Bqt0gWw5.js";import{c as b}from"./createToken-BCfxSjGu.js";import{c as g,s as v}from"./showPhoto-DbG4j3_m.js";import{s as w,r as _}from"./setInProgressLoader-BAB2lVXe.js";function c(){return!!new URL(window.location.href).searchParams.get("redact")}const e={form:document.querySelector(".change-profile-form"),title:document.querySelector(".change-profile__title"),photo:document.querySelector(".change-profile-form__img"),password:document.querySelector(".change-profile-form__item_password"),btnSubmit:document.querySelector(".change-profile-form__btn-submit"),error:document.querySelector(".change-profile__error")};async function n(t){t.preventDefault(),y(),w();try{const r=g(e.form);if(c())await l(r);else{const o=await p(r);b(o.token)}window.location.href="profile.html"}catch{e.error.textContent="Неравельно ввід або такий юзер вже є",S()}finally{_()}}function y(){e.form.addEventListener("submit",f),e.form.removeEventListener("submit",n)}function S(){e.form.removeEventListener("submit",f),e.form.addEventListener("submit",n)}function f(t){t.preventDefault()}async function L(){const{username:t,adress:r,phone:o,email:u}=e.form,a={username:t,adress:r,phone:o,email:u},{user:s}=await h();for(const m in a)a[m].value=s[m];const i=document.querySelector(".change-profile-form__svg");i.src=s.avatar,i.classList.add("big-photo")}function q(){e.title.textContent="Редактировка",e.btnSubmit.textContent="Зберегти",e.password.remove()}async function E(){q(),await L()}e.photo.onchange=v.bind(void 0,e.photo);c()&&await E();e.form.addEventListener("submit",n);d();
