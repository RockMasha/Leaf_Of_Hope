import{h as u}from"./hiddenContentLoader-DtnzIxqs.js";import{r as l,h as d,f as p}from"./api-Bqt0gWw5.js";import{c as h}from"./createToken-BCfxSjGu.js";import{c as b,s as g}from"./showPhoto-DbG4j3_m.js";import{s as v,r as _}from"./setInProgressLoader-BAB2lVXe.js";function c(){return!!new URL(window.location.href).searchParams.get("redact")}const e={form:document.querySelector(".change-profile-form"),title:document.querySelector(".change-profile__title"),photo:document.querySelector(".change-profile-form__img"),password:document.querySelector(".change-profile-form__item_password"),email:document.querySelector(".change-profile-form__enter_email"),btnSubmit:document.querySelector(".change-profile-form__btn-submit"),error:document.querySelector(".change-profile__error")};async function n(t){t.preventDefault(),w(),v();try{const r=b(e.form);if(c())await l(r);else{const o=await d(r);h(o.token)}window.location.href="profile.html"}catch{e.error.textContent="Неравельно ввід або такий юзер вже є",y()}finally{_()}}function w(){e.form.addEventListener("submit",f),e.form.removeEventListener("submit",n)}function y(){e.form.removeEventListener("submit",f),e.form.addEventListener("submit",n)}function f(t){t.preventDefault()}async function S(){const{username:t,adress:r,phone:o}=e.form,a={username:t,adress:r,phone:o},{user:i}=await p();for(const m in a)a[m].value=i[m];const s=document.querySelector(".change-profile-form__svg");s.src=i.avatar,s.classList.add("big-photo")}function L(){e.title.textContent="Редактировка",e.btnSubmit.textContent="Зберегти",e.password.remove(),e.email.remove()}async function q(){L(),await S()}e.photo.onchange=g.bind(void 0,e.photo);c()&&await q();e.form.addEventListener("submit",n);u();
